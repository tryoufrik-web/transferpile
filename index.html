<!DOCTYPE html>
<html>
<head>
    <title>üì± Wireless File Transfer - Dual Device</title>
    <meta charset="UTF-8">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #1a1a2e, #16213e); 
            color: white; 
            font-family: 'Segoe UI', sans-serif;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* Header */
        header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #00adb5; }
        h1 { color: #00adb5; font-size: 2.5em; margin-bottom: 10px; }
        
        /* Dual Panel */
        .dual-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .dual-panel { grid-template-columns: 1fr; }
        }
        
        /* Device Card */
        .device-card {
            background: rgba(30, 30, 46, 0.95);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid #00adb5;
            box-shadow: 0 10px 30px rgba(0, 173, 181, 0.2);
        }
        
        .device-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0, 173, 181, 0.3);
        }
        
        .device-icon {
            font-size: 2.5em;
            color: #00adb5;
        }
        
        .device-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #00adb5;
        }
        
        /* Code Box */
        .code-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px dashed #00adb5;
            text-align: center;
        }
        
        .code-label {
            color: #88d3ce;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .device-code {
            font-size: 3.5em;
            font-weight: bold;
            color: #00adb5;
            letter-spacing: 15px;
            font-family: monospace;
            margin: 15px 0;
            text-shadow: 0 0 20px rgba(0, 173, 181, 0.5);
        }
        
        /* Input Group */
        .input-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .code-input {
            flex: 1;
            padding: 15px;
            font-size: 1.3em;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #00adb5;
            border-radius: 10px;
            color: white;
            text-align: center;
            letter-spacing: 8px;
            font-weight: bold;
        }
        
        .code-input:focus {
            outline: none;
            border-color: #2ed573;
            box-shadow: 0 0 20px rgba(46, 213, 115, 0.3);
        }
        
        /* Status */
        .connection-status {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .status-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ff4757;
        }
        
        .status-dot.connected {
            background: #2ed573;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* File Upload */
        .file-zone {
            border: 3px dashed #00adb5;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            margin: 20px 0;
            background: rgba(0, 173, 181, 0.05);
        }
        
        .file-zone:hover {
            background: rgba(0, 173, 181, 0.1);
            border-color: #2ed573;
        }
        
        .file-list {
            margin-top: 20px;
            max-height: 250px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid #00adb5;
        }
        
        /* Buttons */
        button {
            background: #00adb5;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        button:hover:not(:disabled) {
            background: #0097a7;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 173, 181, 0.4);
        }
        
        button:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .btn-secondary {
            background: #393e46;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #2c2f35;
        }
        
        .btn-success {
            background: #2ed573;
        }
        
        /* Transfer Panel */
        .transfer-panel {
            grid-column: span 2;
            background: rgba(30, 30, 46, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            border: 2px solid #00adb5;
            display: none;
        }
        
        .transfer-panel.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Progress */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00adb5, #2ed573);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* Instructions */
        .instructions {
            background: rgba(255, 215, 0, 0.1);
            border-left: 4px solid gold;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        /* Logs */
        .logs {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 30px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #88d3ce;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-exchange-alt"></i> Dual Device Transfer</h1>
            <p>Two Devices ‚Ä¢ One Connection ‚Ä¢ No QR Code</p>
        </header>
        
        <!-- DUAL DEVICE PANELS -->
        <div class="dual-panel">
            <!-- DEVICE 1: LAPTOP -->
            <div class="device-card" id="device1">
                <div class="device-header">
                    <div class="device-icon"><i class="fas fa-laptop"></i></div>
                    <div class="device-title">DEVICE 1 (Laptop/PC)</div>
                </div>
                
                <div class="code-box">
                    <div class="code-label"><i class="fas fa-key"></i> Your Connection Code</div>
                    <div class="device-code" id="device1Code">ABCD</div>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                        <button onclick="copyCode('device1')">
                            <i class="fas fa-copy"></i> Copy Code
                        </button>
                        <button onclick="newCode('device1')" class="btn-secondary">
                            <i class="fas fa-redo"></i> New Code
                        </button>
                    </div>
                </div>
                
                <div class="connection-status" id="device1Status">
                    <span class="status-dot" id="device1Dot"></span>
                    <span id="device1StatusText">Not Connected</span>
                </div>
                
                <div class="input-group">
                    <input type="text" class="code-input" id="device1Input" placeholder="Enter Device 2 Code" maxlength="4">
                    <button onclick="connectDevices('device1')" id="device1ConnectBtn">
                        <i class="fas fa-plug"></i> Connect
                    </button>
                </div>
                
                <!-- File Transfer Section -->
                <div id="device1Transfer" style="display: none;">
                    <h3 style="color: #00adb5; margin: 20px 0 15px;"><i class="fas fa-file-upload"></i> Send Files</h3>
                    
                    <div class="file-zone" id="device1DropZone" onclick="document.getElementById('device1FileInput').click()">
                        <input type="file" id="device1FileInput" style="display: none;" multiple>
                        <i class="fas fa-cloud-upload-alt" style="font-size: 2.5em; color: #00adb5; margin-bottom: 10px;"></i>
                        <h4>Drag & Drop Files Here</h4>
                        <p style="color: #88d3ce; font-size: 0.9em;">or click to select</p>
                    </div>
                    
                    <div class="file-list" id="device1FileList">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            <i class="fas fa-folder-open" style="font-size: 2em;"></i>
                            <p>No files selected</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="startTransfer('device1')" id="device1TransferBtn" disabled style="flex: 2;">
                            <i class="fas fa-paper-plane"></i> Send Files
                        </button>
                        <button onclick="clearFiles('device1')" class="btn-secondary">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                </div>
                
                <!-- Receive Section -->
                <div id="device1Receive" style="display: none; margin-top: 25px;">
                    <h3 style="color: #00adb5; margin-bottom: 15px;"><i class="fas fa-download"></i> Received Files</h3>
                    <div class="file-list" id="device1ReceivedList">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            <i class="fas fa-inbox" style="font-size: 2em;"></i>
                            <p>No files received yet</p>
                        </div>
                    </div>
                    <button onclick="downloadAll('device1')" id="device1DownloadBtn" disabled style="width: 100%; margin-top: 15px;" class="btn-success">
                        <i class="fas fa-download"></i> Download All Files
                    </button>
                </div>
            </div>
            
            <!-- DEVICE 2: PHONE -->
            <div class="device-card" id="device2">
                <div class="device-header">
                    <div class="device-icon"><i class="fas fa-mobile-alt"></i></div>
                    <div class="device-title">DEVICE 2 (Phone/Mobile)</div>
                </div>
                
                <div class="code-box">
                    <div class="code-label"><i class="fas fa-key"></i> Your Connection Code</div>
                    <div class="device-code" id="device2Code">EFGH</div>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                        <button onclick="copyCode('device2')">
                            <i class="fas fa-copy"></i> Copy Code
                        </button>
                        <button onclick="newCode('device2')" class="btn-secondary">
                            <i class="fas fa-redo"></i> New Code
                        </button>
                    </div>
                </div>
                
                <div class="connection-status" id="device2Status">
                    <span class="status-dot" id="device2Dot"></span>
                    <span id="device2StatusText">Not Connected</span>
                </div>
                
                <div class="input-group">
                    <input type="text" class="code-input" id="device2Input" placeholder="Enter Device 1 Code" maxlength="4">
                    <button onclick="connectDevices('device2')" id="device2ConnectBtn">
                        <i class="fas fa-plug"></i> Connect
                    </button>
                </div>
                
                <!-- File Transfer Section -->
                <div id="device2Transfer" style="display: none;">
                    <h3 style="color: #00adb5; margin: 20px 0 15px;"><i class="fas fa-file-upload"></i> Send Files</h3>
                    
                    <div class="file-zone" id="device2DropZone" onclick="document.getElementById('device2FileInput').click()">
                        <input type="file" id="device2FileInput" style="display: none;" multiple>
                        <i class="fas fa-cloud-upload-alt" style="font-size: 2.5em; color: #00adb5; margin-bottom: 10px;"></i>
                        <h4>Drag & Drop Files Here</h4>
                        <p style="color: #88d3ce; font-size: 0.9em;">or click to select</p>
                    </div>
                    
                    <div class="file-list" id="device2FileList">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            <i class="fas fa-folder-open" style="font-size: 2em;"></i>
                            <p>No files selected</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="startTransfer('device2')" id="device2TransferBtn" disabled style="flex: 2;">
                            <i class="fas fa-paper-plane"></i> Send Files
                        </button>
                        <button onclick="clearFiles('device2')" class="btn-secondary">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                </div>
                
                <!-- Receive Section -->
                <div id="device2Receive" style="display: none; margin-top: 25px;">
                    <h3 style="color: #00adb5; margin-bottom: 15px;"><i class="fas fa-download"></i> Received Files</h3>
                    <div class="file-list" id="device2ReceivedList">
                        <div style="text-align: center; color: #888; padding: 20px;">
                            <i class="fas fa-inbox" style="font-size: 2em;"></i>
                            <p>No files received yet</p>
                        </div>
                    </div>
                    <button onclick="downloadAll('device2')" id="device2DownloadBtn" disabled style="width: 100%; margin-top: 15px;" class="btn-success">
                        <i class="fas fa-download"></i> Download All Files
                    </button>
                </div>
            </div>
        </div>
        
        <!-- INSTRUCTIONS -->
        <div class="instructions">
            <h3 style="color: gold;"><i class="fas fa-info-circle"></i> Cara Koneksi 2 Device:</h3>
            <p style="margin-bottom: 10px;">1Ô∏è‚É£ <strong>Device 1 (Laptop):</strong> Copy code "ABCD" ‚Üí Share ke Device 2</p>
            <p style="margin-bottom: 10px;">2Ô∏è‚É£ <strong>Device 2 (HP):</strong> Masukkan kode "ABCD" ‚Üí Klik Connect</p>
            <p style="margin-bottom: 10px;">3Ô∏è‚É£ <strong>Device 2 (HP):</strong> Copy code "EFGH" ‚Üí Share ke Device 1</p>
            <p style="margin-bottom: 10px;">4Ô∏è‚É£ <strong>Device 1 (Laptop):</strong> Masukkan kode "EFGH" ‚Üí Klik Connect</p>
            <p style="color: #88d3ce; margin-top: 15px;"><i class="fas fa-check-circle"></i> Kedua device akan connected dan bisa transfer file!</p>
        </div>
        
        <!-- GLOBAL LOGS -->
        <div class="logs" id="globalLogs">
            <div class="log-entry">[System] Dual Device Transfer siap digunakan</div>
        </div>
    </div>

    <script>
        // State untuk kedua device
        const devices = {
            device1: {
                code: 'ABCD',
                connectedTo: null,
                isConnected: false,
                selectedFiles: [],
                receivedFiles: [],
                otherDeviceCode: null
            },
            device2: {
                code: 'EFGH',
                connectedTo: null,
                isConnected: false,
                selectedFiles: [],
                receivedFiles: [],
                otherDeviceCode: null
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeDevice('device1');
            initializeDevice('device2');
            log('[System] Kedua device siap. Silakan koneksikan!');
        });

        function initializeDevice(deviceId) {
            // Generate initial codes
            if (deviceId === 'device1') {
                devices.device1.code = generateCode();
                document.getElementById('device1Code').textContent = devices.device1.code;
            } else {
                devices.device2.code = generateCode();
                document.getElementById('device2Code').textContent = devices.device2.code;
            }
            
            // Setup file input listeners
            setupFileListeners(deviceId);
        }

        function generateCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 4; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function newCode(deviceId) {
            devices[deviceId].code = generateCode();
            document.getElementById(`${deviceId}Code`).textContent = devices[deviceId].code;
            log(`[${deviceId}] New code generated: ${devices[deviceId].code}`);
        }

        function copyCode(deviceId) {
            const code = devices[deviceId].code;
            navigator.clipboard.writeText(code);
            alert(`Code ${code} copied!`);
            log(`[${deviceId}] Code copied: ${code}`);
        }

        function connectDevices(deviceId) {
            const inputId = `${deviceId}Input`;
            const enteredCode = document.getElementById(inputId).value.toUpperCase();
            
            if (enteredCode.length !== 4) {
                alert('Masukkan 4 digit code!');
                return;
            }
            
            // Cari device lain
            const otherDeviceId = deviceId === 'device1' ? 'device2' : 'device1';
            const otherDeviceCode = devices[otherDeviceId].code;
            
            if (enteredCode === devices[deviceId].code) {
                alert('Tidak bisa connect ke diri sendiri!');
                return;
            }
            
            if (enteredCode === otherDeviceCode) {
                // Connect success!
                devices[deviceId].isConnected = true;
                devices[deviceId].connectedTo = otherDeviceId;
                devices[deviceId].otherDeviceCode = enteredCode;
                
                // Update UI
                document.getElementById(`${deviceId}Dot`).className = 'status-dot connected';
                document.getElementById(`${deviceId}StatusText`).textContent = `Connected to ${otherDeviceId}`;
                document.getElementById(`${deviceId}ConnectBtn`).disabled = true;
                document.getElementById(`${deviceId}ConnectBtn`).innerHTML = '<i class="fas fa-check"></i> Connected';
                
                // Show transfer section
                document.getElementById(`${deviceId}Transfer`).style.display = 'block';
                document.getElementById(`${deviceId}Receive`).style.display = 'block';
                
                log(`[${deviceId}] Connected to ${otherDeviceId} (Code: ${enteredCode})`);
                
                // Cek apakah kedua device sudah saling connect
                if (devices[otherDeviceId].isConnected && devices[otherDeviceId].connectedTo === deviceId) {
                    log('[System] KONEKSI SUKSES! Kedua device terhubung!');
                    alert('‚úÖ Koneksi berhasil! Kedua device siap transfer file!');
                }
            } else {
                alert('Code salah! Coba lagi.');
            }
        }

        function setupFileListeners(deviceId) {
            const dropZone = document.getElementById(`${deviceId}DropZone`);
            const fileInput = document.getElementById(`${deviceId}FileInput`);
            
            // Drag & drop
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.background = 'rgba(0, 173, 181, 0.2)';
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.style.background = '';
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.background = '';
                handleFiles(deviceId, Array.from(e.dataTransfer.files));
            });
            
            // File input change
            fileInput.addEventListener('change', (e) => {
                handleFiles(deviceId, Array.from(e.target.files));
            });
        }

        function handleFiles(deviceId, files) {
            if (files.length === 0) return;
            
            // Limit to 10 files
            if (files.length > 10) {
                alert('Max 10 files!');
                files = files.slice(0, 10);
            }
            
            files.forEach(file => {
                devices[deviceId].selectedFiles.push({
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    file: file,
                    progress: 0
                });
            });
            
            updateFileList(deviceId);
            log(`[${deviceId}] Added ${files.length} file(s)`);
        }

        function updateFileList(deviceId) {
            const fileList = document.getElementById(`${deviceId}FileList`);
            const transferBtn = document.getElementById(`${deviceId}TransferBtn`);
            const files = devices[deviceId].selectedFiles;
            
            if (files.length === 0) {
                fileList.innerHTML = `
                    <div style="text-align: center; color: #888; padding: 20px;">
                        <i class="fas fa-folder-open" style="font-size: 2em;"></i>
                        <p>No files selected</p>
                    </div>
                `;
                transferBtn.disabled = true;
                return;
            }
            
            transferBtn.disabled = false;
            
            let html = '';
            files.forEach((file, index) => {
                const icon = getFileIcon(file.type);
                const size = formatFileSize(file.size);
                html += `
                    <div class="file-item">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5em;">${icon}</span>
                            <div>
                                <div style="font-weight: 600;">${file.name}</div>
                                <div style="font-size: 0.8em; color: #88d3ce;">${size}</div>
                                <div class="progress-bar" style="width: 150px; margin-top: 5px;">
                                    <div class="progress-fill" style="width: ${file.progress}%;"></div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <i class="fas fa-times" style="color: #ff4757; cursor: pointer;" onclick="removeFile('${deviceId}', ${index})"></i>
                        </div>
                    </div>
                `;
            });
            
            fileList.innerHTML = html;
        }

        function removeFile(deviceId, index) {
            devices[deviceId].selectedFiles.splice(index, 1);
            updateFileList(deviceId);
        }

        function clearFiles(deviceId) {
            devices[deviceId].selectedFiles = [];
            updateFileList(deviceId);
            log(`[${deviceId}] Cleared all files`);
        }

        function startTransfer(deviceId) {
            if (!devices[deviceId].isConnected) {
                alert('Not connected!');
                return;
            }
            
            const files = devices[deviceId].selectedFiles;
            if (files.length === 0) return;
            
            const otherDeviceId = devices[deviceId].connectedTo;
            
            log(`[${deviceId}] Starting transfer to ${otherDeviceId}...`);
            
            // Simulate transfer
            files.forEach((file, index) => {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 30;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                        
                        // Add to received files on other device
                        devices[otherDeviceId].receivedFiles.push({
                            name: file.name,
                            size: file.size,
                            type: file.type
                        });
                        
                        updateReceivedList(otherDeviceId);
                        
                        // Update progress
                        file.progress = 100;
                        updateFileList(deviceId);
                        
                        log(`[${deviceId}] ‚úì Sent: ${file.name}`);
                    } else {
                        file.progress = progress;
                        updateFileList(deviceId);
                    }
                }, 200);
            });
            
            // Enable download button on other device
            setTimeout(() => {
                document.getElementById(`${otherDeviceId}DownloadBtn`).disabled = false;
            }, files.length * 1000);
        }

        function updateReceivedList(deviceId) {
            const receivedList = document.getElementById(`${deviceId}ReceivedList`);
            const files = devices[deviceId].receivedFiles;
            
            if (files.length === 0) {
                receivedList.innerHTML = `
                    <div style="text-align: center; color: #888; padding: 20px;">
                        <i class="fas fa-inbox" style="font-size: 2em;"></i>
                        <p>No files received yet</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            files.forEach((file, index) => {
                const icon = getFileIcon(file.type);
                const size = formatFileSize(file.size);
                html += `
                    <div class="file-item">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5em;">${icon}</span>
                            <div>
                                <div style="font-weight: 600;">${file.name}</div>
                                <div style="font-size: 0.8em; color: #88d3ce;">${size}</div>
                                <div style="color: #2ed573; font-size: 0.8em;">
                                    <i class="fas fa-check-circle"></i> Ready
                                </div>
                            </div>
                        </div>
                        <div>
                            <i class="fas fa-download" style="color: #00adb5; cursor: pointer;" onclick="downloadFile('${deviceId}', ${index})"></i>
                        </div>
                    </div>
                `;
            });
            
            receivedList.innerHTML = html;
            document.getElementById(`${deviceId}DownloadBtn`).disabled = false;
        }

        function downloadFile(deviceId, index) {
            const file = devices[deviceId].receivedFiles[index];
            
            // Simulate download
            const blob = new Blob([`File: ${file.name}\nSize: ${file.size}\nTransferred via Wireless Transfer`], 
                                 { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = file.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log(`[${deviceId}] Downloaded: ${file.name}`);
        }

        function downloadAll(deviceId) {
            const files = devices[deviceId].receivedFiles;
            files.forEach((file, index) => {
                setTimeout(() => {
                    downloadFile(deviceId, index);
                }, index * 500);
            });
            log(`[${deviceId}] Downloading ${files.length} file(s)...`);
        }

        function getFileIcon(type) {
            if (type.includes('image')) return 'üñºÔ∏è';
            if (type.includes('video')) return 'üé¨';
            if (type.includes('audio')) return 'üéµ';
            if (type.includes('pdf')) return 'üìÑ';
            if (type.includes('zip')) return 'üì¶';
            if (type.includes('text')) return 'üìù';
            return 'üìÅ';
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
        }

        function log(message) {
            const logs = document.getElementById('globalLogs');
            const now = new Date();
            const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `[${time}] ${message}`;
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
            
            // Keep last 15 logs
            while (logs.children.length > 15) {
                logs.removeChild(logs.firstChild);
            }
        }
    </script>
</body>
</html>
