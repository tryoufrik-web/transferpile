<!DOCTYPE html>
<html>
<head>
    <title>Wireless File Transfer</title>
    <meta charset="UTF-8">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #1a1a2e, #16213e); color: #ffffff; min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #00adb5; }
        h1 { color: #00adb5; font-size: 2em; margin-bottom: 10px; }
        .panel { background: rgba(30, 30, 46, 0.8); border-radius: 15px; padding: 25px; margin: 20px 0; border: 1px solid rgba(0, 173, 181, 0.3); }
        .file-drop-zone { border: 3px dashed #00adb5; border-radius: 15px; padding: 40px 20px; text-align: center; cursor: pointer; margin: 20px 0; }
        .file-drop-zone:hover { background: rgba(0, 173, 181, 0.1); }
        .file-list { margin-top: 20px; max-height: 300px; overflow-y: auto; }
        .file-item { background: rgba(255, 255, 255, 0.05); padding: 12px 15px; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        button { background: #00adb5; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 5px; width: 100%; }
        button:hover { background: #0097a7; }
        button:disabled { background: #666; cursor: not-allowed; }
        .connection-code { font-size: 2.5em; font-weight: bold; color: #00adb5; text-align: center; margin: 20px 0; font-family: monospace; }
        .input-group { display: flex; gap: 10px; margin: 20px 0; }
        .code-input { flex: 1; padding: 15px; background: rgba(0, 0, 0, 0.3); border: 2px solid #00adb5; border-radius: 8px; color: white; font-size: 1.2em; text-align: center; }
        .qr-container { text-align: center; margin: 20px 0; }
        #qrCode { width: 200px; height: 200px; margin: 0 auto; background: white; padding: 10px; border-radius: 10px; }
        .status { display: flex; align-items: center; gap: 10px; margin: 15px 0; }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; background: #ff4757; }
        .status-dot.connected { background: #2ed573; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .logs { background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 15px; margin-top: 20px; font-family: monospace; font-size: 0.9em; max-height: 200px; overflow-y: auto; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-wifi"></i> Wireless File Transfer</h1>
            <p>Simple • Easy to Use • Works on Laptop & Phone</p>
        </header>
        
        <!-- STEP 1: CONNECTION -->
        <div class="panel" id="step1">
            <h2><i class="fas fa-link"></i> Step 1: Connect Devices</h2>
            
            <div class="connection-code" id="myCode">ABCD</div>
            <p style="text-align: center; color: #aaa; margin-bottom: 20px;">
                Share this code with the other device
            </p>
            
            <div class="qr-container">
                <canvas id="qrCode"></canvas>
                <p style="color: #aaa; margin-top: 10px;">Scan with phone camera</p>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button onclick="copyCode()">
                    <i class="fas fa-copy"></i> Copy My Code
                </button>
                <button onclick="newCode()" style="background: #393e46;">
                    <i class="fas fa-redo"></i> New Code
                </button>
            </div>
            
            <div style="margin: 30px 0;">
                <h3><i class="fas fa-sign-in-alt"></i> Enter Other Device's Code</h3>
                <div class="input-group">
                    <input type="text" class="code-input" id="otherCode" placeholder="Enter 4-digit code" maxlength="4">
                    <button onclick="connect()" id="connectBtn">
                        <i class="fas fa-plug"></i> Connect
                    </button>
                </div>
            </div>
            
            <div class="status">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">Not connected</span>
            </div>
        </div>
        
        <!-- STEP 2: FILE SELECTION -->
        <div class="panel" id="step2" style="display: none;">
            <h2><i class="fas fa-file-upload"></i> Step 2: Select Files</h2>
            
            <div class="status">
                <span class="status-dot connected"></span>
                <span>Connected to device: <span id="connectedDevice">ABCD</span></span>
            </div>
            
            <div class="file-drop-zone" id="dropZone">
                <input type="file" id="fileInput" style="display: none;" multiple>
                <i class="fas fa-cloud-upload-alt" style="font-size: 3em; color: #00adb5; margin-bottom: 15px;"></i>
                <h3>Drag & Drop Files Here</h3>
                <p>or click to select files</p>
                <p style="color: #aaa; font-size: 0.9em; margin-top: 10px;">
                    Supports images, videos, documents, etc.
                </p>
            </div>
            
            <div class="file-list" id="fileList">
                <div style="text-align: center; color: #888; padding: 30px;">
                    <i class="fas fa-folder-open" style="font-size: 2em;"></i>
                    <p>No files selected</p>
                </div>
            </div>
            
            <button onclick="startTransfer()" id="transferBtn" disabled>
                <i class="fas fa-paper-plane"></i> Start Transfer
            </button>
            <button onclick="clearFiles()" style="background: #ff4757;">
                <i class="fas fa-trash"></i> Clear All Files
            </button>
        </div>
        
        <!-- STEP 3: TRANSFER PROGRESS -->
        <div class="panel" id="step3" style="display: none;">
            <h2><i class="fas fa-exchange-alt"></i> Step 3: Transfer Progress</h2>
            
            <div class="status">
                <span class="status-dot connected"></span>
                <span>Transferring files to <span id="transferToDevice">ABCD</span></span>
            </div>
            
            <div class="file-list" id="transferList">
                <!-- Progress will show here -->
            </div>
            
            <div style="margin: 20px 0;">
                <div style="background: rgba(255, 255, 255, 0.1); height: 10px; border-radius: 5px; overflow: hidden;">
                    <div id="progressBar" style="height: 100%; background: #00adb5; width: 0%; transition: width 0.3s;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <span id="progressText">0%</span>
                    <span id="fileCounter">0/0 files</span>
                </div>
            </div>
            
            <button onclick="downloadFiles()" id="downloadBtn" disabled style="background: #2ed573;">
                <i class="fas fa-download"></i> Download Received Files
            </button>
            <button onclick="newTransfer()">
                <i class="fas fa-plus"></i> New Transfer
            </button>
        </div>
        
        <div class="logs" id="logs">
            <div style="color: #00adb5;">[System] Ready to transfer files</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        // Simple state
        let myCode = 'ABCD';
        let otherCode = '';
        let isConnected = false;
        let selectedFiles = [];
        let transferProgress = {};
        
        // DOM elements
        const myCodeElement = document.getElementById('myCode');
        const otherCodeInput = document.getElementById('otherCode');
        const connectBtn = document.getElementById('connectBtn');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const transferList = document.getElementById('transferList');
        const transferBtn = document.getElementById('transferBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const fileCounter = document.getElementById('fileCounter');
        const connectedDevice = document.getElementById('connectedDevice');
        const transferToDevice = document.getElementById('transferToDevice');
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const logs = document.getElementById('logs');
        
        // Initialize
        window.onload = function() {
            generateCode();
            setupEventListeners();
            log('System ready');
        };
        
        function generateCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            myCode = '';
            for (let i = 0; i < 4; i++) {
                myCode += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            myCodeElement.textContent = myCode;
            
            // Generate QR code
            QRCode.toCanvas(document.getElementById('qrCode'), myCode, {
                width: 200,
                height: 200,
                color: { dark: '#000000', light: '#FFFFFF' }
            });
        }
        
        function setupEventListeners() {
            // File input
            dropZone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFiles);
            
            // Drag and drop
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.background = 'rgba(0, 173, 181, 0.1)';
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.style.background = '';
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.background = '';
                handleFiles(e.dataTransfer.files);
            });
            
            // Code input
            otherCodeInput.addEventListener('input', function() {
                this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
                connectBtn.disabled = this.value.length !== 4;
            });
        }
        
        function copyCode() {
            navigator.clipboard.writeText(myCode);
            alert('Code copied: ' + myCode);
            log('Code copied to clipboard');
        }
        
        function newCode() {
            generateCode();
            log('New code generated');
        }
        
        function connect() {
            otherCode = otherCodeInput.value;
            if (otherCode.length !== 4) {
                alert('Enter 4-character code');
                return;
            }
            
            if (otherCode === myCode) {
                alert('Cannot connect to yourself!');
                return;
            }
            
            // Update UI
            statusDot.className = 'status-dot connected';
            statusText.textContent = 'Connected to ' + otherCode;
            connectBtn.disabled = true;
            connectBtn.innerHTML = '<i class="fas fa-check"></i> Connected';
            
            // Show step 2
            connectedDevice.textContent = otherCode;
            step1.style.display = 'none';
            step2.style.display = 'block';
            
            log('Connected to device: ' + otherCode);
        }
        
        function handleFiles(event) {
            const files = event.target?.files || event;
            selectedFiles = Array.from(files);
            
            // Update file list
            fileList.innerHTML = '';
            selectedFiles.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <div>
                        <strong>${file.name}</strong><br>
                        <small style="color: #aaa;">${formatSize(file.size)}</small>
                    </div>
                    <div>
                        <i class="fas fa-times" style="color: #ff4757; cursor: pointer;" 
                           onclick="removeFile(${index})"></i>
                    </div>
                `;
                fileList.appendChild(item);
            });
            
            // Enable transfer button
            transferBtn.disabled = selectedFiles.length === 0;
            
            log(`Added ${selectedFiles.length} file(s)`);
        }
        
        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
        }
        
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            handleFiles(selectedFiles);
        }
        
        function clearFiles() {
            selectedFiles = [];
            fileList.innerHTML = `
                <div style="text-align: center; color: #888; padding: 30px;">
                    <i class="fas fa-folder-open" style="font-size: 2em;"></i>
                    <p>No files selected</p>
                </div>
            `;
            transferBtn.disabled = true;
            log('Cleared all files');
        }
        
        function startTransfer() {
            if (selectedFiles.length === 0) {
                alert('Select files first!');
                return;
            }
            
            // Update UI
            transferToDevice.textContent = otherCode;
            step2.style.display = 'none';
            step3.style.display = 'block';
            
            // Show transfer list
            transferList.innerHTML = '';
            selectedFiles.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.id = 'transfer-item-' + index;
                item.innerHTML = `
                    <div>
                        <strong>${file.name}</strong><br>
                        <small style="color: #aaa;">${formatSize(file.size)}</small>
                        <div style="background: rgba(255, 255, 255, 0.1); height: 4px; border-radius: 2px; margin-top: 5px;">
                            <div id="file-progress-${index}" style="height: 100%; background: #00adb5; width: 0%;"></div>
                        </div>
                    </div>
                    <div id="file-status-${index}">
                        <i class="fas fa-clock" style="color: #ffa502;"></i>
                    </div>
                `;
                transferList.appendChild(item);
            });
            
            // Start simulated transfer
            simulateTransfer();
        }
        
        function simulateTransfer() {
            let completed = 0;
            const totalFiles = selectedFiles.length;
            
            selectedFiles.forEach((file, index) => {
                // Simulate progress for each file
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 20;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                        
                        // Update status
                        document.getElementById('file-status-' + index).innerHTML = 
                            '<i class="fas fa-check" style="color: #2ed573;"></i>';
                        
                        completed++;
                        
                        // Update overall progress
                        const overallProgress = Math.round((completed / totalFiles) * 100);
                        progressBar.style.width = overallProgress + '%';
                        progressText.textContent = overallProgress + '%';
                        fileCounter.textContent = completed + '/' + totalFiles + ' files';
                        
                        // Enable download when all complete
                        if (completed === totalFiles) {
                            downloadBtn.disabled = false;
                            log('Transfer completed successfully!');
                        }
                    } else {
                        // Update file progress
                        document.getElementById('file-progress-' + index).style.width = progress + '%';
                    }
                }, 200);
            });
            
            log('Transfer started...');
        }
        
        function downloadFiles() {
            // Create and trigger downloads for each file
            selectedFiles.forEach(file => {
                const blob = new Blob([`Content of ${file.name}\nDownloaded via Wireless Transfer`], 
                                     { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = file.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            alert('Files downloaded successfully!');
            log('Files downloaded to device');
        }
        
        function newTransfer() {
            // Reset everything
            selectedFiles = [];
            otherCodeInput.value = '';
            connectBtn.disabled = true;
            connectBtn.innerHTML = '<i class="fas fa-plug"></i> Connect';
            statusDot.className = 'status-dot';
            statusText.textContent = 'Not connected';
            downloadBtn.disabled = true;
            progressBar.style.width = '0%';
            progressText.textContent = '0%';
            
            // Show step 1
            step3.style.display = 'none';
            step1.style.display = 'block';
            
            log('Ready for new transfer');
        }
        
        function log(message) {
            const now = new Date();
            const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${time}] ${message}`;
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
            
            // Keep only last 10 logs
            while (logs.children.length > 10) {
                logs.removeChild(logs.firstChild);
            }
        }
    </script>
</body>
</html>
